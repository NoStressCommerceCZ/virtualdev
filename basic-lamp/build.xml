<?xml version="1.0" encoding="UTF-8"?>
<project name="vagrant-virtualdev-basic-lamp-project">

	<description>
	The script create a vagrant package and provide facility to start and stop a VM.
	<!-- FIXME - improve description -->
	</description>

	<!-- FIXME - add short desc here -->
	<property name="vm.box" value="virtualdev-basic-lamp" />
	
	<!-- FIXME - this is OS depends -->
	<property name="vagrant.bin" value="vagrant.bat" />
	
	<!-- FIXME - add short desc here -->
	<property name="file.box" value="${vm.box}.box" />

	<!-- FIXME - add target desc here -->
	<target name="vm-package">
		<exec executable="${vagrant.bin}" failonerror="no" >
			<arg line="box remove ${vm.box}" />
		</exec>

		<exec executable="${vagrant.bin}" failonerror="yes" >
			<arg line="package --base ${vm.box} --vagrantfile ${basedir}/Vagrantfile --output ${basedir}/${file.box}" />
		</exec>

		<exec executable="${vagrant.bin}" failonerror="no" >
			<arg line="box add ${vm.box} ${basedir}/${file.box}" />
		</exec>

		<delete file="${file.box}" failonerror="no" />
	</target>

	<!-- FIXME - add target desc here -->
	<target name="vm-up">
		<mkdir dir="${basedir}/test_environment" />
		<mkdir dir="${basedir}/test_environment/data" />
		<mkdir dir="${basedir}/test_environment/puppet" />
		<copy todir="${basedir}/test_environment/puppet">
			<fileset dir="${basedir}/puppet" />
		</copy>
		<copy file="${basedir}/Vagrantfile" tofile="${basedir}/test_environment/Vagrantfile" />

		<exec dir="${basedir}/test_environment" executable="${vagrant.bin}" >
			<arg line="init ${vm.box}" />
		</exec>

		<exec dir="${basedir}/test_environment" executable="${vagrant.bin}" failonerror="yes">
			<arg line="up" />
		</exec>
	</target>

	<!-- FIXME - add target desc here -->
	<target name="vm-down">
		<exec dir="${basedir}/test_environment" executable="${vagrant.bin}" failonerror="yes">
			<arg line="halt" />
		</exec>
	</target>

</project>